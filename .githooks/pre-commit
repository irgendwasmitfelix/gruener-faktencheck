#!/usr/bin/env node
/**
 * Pre-commit hook: Generiert Sitemap und Static HTML vor dem Commit
 * Funktioniert auf Windows, Mac und Linux
 */

const { execSync } = require('child_process');
const path = require('path');

console.log('üîÑ Generiere Sitemap und Static HTML...');

const projectRoot = path.resolve(__dirname, '..');
const pythonCmd = process.platform === 'win32' ? 'python' : 'python3';

try {
  // F√ºhre generate_sitemap.py aus
  console.log('üìÑ Generiere Sitemap...');
  execSync(`${pythonCmd} scripts/generate_sitemap.py`, { 
    cwd: projectRoot,
    stdio: 'inherit'
  });

  // F√ºhre generate_static_html.py aus
  console.log('üåê Generiere statisches HTML...');
  execSync(`${pythonCmd} scripts/generate_static_html.py`, { 
    cwd: projectRoot,
    stdio: 'inherit'
  });

  // F√ºge generierte Dateien zum Commit hinzu
  console.log('üìù F√ºge generierte Dateien hinzu...');
  execSync('git add public/sitemap.xml', { cwd: projectRoot });
  execSync('git add -A static/ 2>/dev/null || true', { cwd: projectRoot });

  console.log('‚úÖ Sitemap und Static HTML aktualisiert!');
  process.exit(0);
} catch (error) {
  console.error('‚ùå Pre-commit hook fehlgeschlagen!');
  console.error(error.message);
  process.exit(1);
}
